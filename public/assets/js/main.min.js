$(window).on('load', function() {
    $('#status').fadeOut();
   // $('#preloader').delay(200).fadeOut('slow');
  //  $('#preloader').fadeOut();
   // $('body').delay(200).css({'overflow':'visible'});
   $('body').css({'overflow':'visible'});
  //  $("#cartModal").modal("show");
  })
  $(function(e){
    $("#preloader").fadeOut();
    $("body").css("overflow", "visible");
  });

   $("#home-slider").owlCarousel({
    items: 1,
    autoplay: true,
    lazyLoad: true,
    loop: true,
    margin: 20,
    navText: [
            "<i class='icon-angle-left'></i>",
            "<i class='icon-angle-right'></i>"
          ],
    responsiveClass: true,
    autoHeight: true,
    autoplayTimeout: 7000,
    smartSpeed: 800,
    nav: true,
    responsive: {
      0: {
        items: 1,
        dots: false,
      },
      600: {
          dots: false,
          nav: false,
      },
      1024: {
      },
      1366: {
      }
    }
  });

$('.best-sale-slider').owlCarousel({
        loop: false,
        margin:10,
        touchDrag  : true,
        mouseDrag  : false,
        nav: true,
        navText: [
        "<i class='icon-angle-left'></i>",
        "<i class='icon-angle-right'></i>"
        ],
        dots: false,
        autoplay: false,
        responsiveClass:true,
        responsive: {
        0: {
        items: 2,
        nav: false
        },
        380: {
        items: 2,
        nav: false
        },
        480: {
        items: 3
        },
        600: {
        items: 3
        },
        1000: {
        items: 4
        }
        }
})

$('.product-nav-slider').owlCarousel({
    loop: false,
    items:5,
    navText: [
        "<i class='icon-angle-left'></i>",
        "<i class='icon-angle-right'></i>"
    ],
    dots: false,
    autoplay: false,
    autoplayHoverPause: true,
    responsiveClass:true,
    responsive: {
        0: {
        items: 3,
        nav: true,
        },
        380: {
        items: 3,
        nav: true,
        },
        600: {
        items: 3,
        nav: true,
        },
        1000: {
        items: 4,
        nav: false
        },
        1100: {
            items: 4,
            nav: false
        },
        1300: {
            items: 4,
            nav: false
        },
        1301: {
            items: 5,
            nav: false
        }
    }
})

$('.variant-slider').owlCarousel({
        loop: false,
        nav: true,
        navText: [
            "<i class='icon-angle-left'></i>",
            "<i class='icon-angle-right'></i>"
        ],
        dots: false,
        autoplay: false,
        autoplayHoverPause: true,
        responsiveClass:true,
        responsive: {
            0: {
            items: 3,
            nav: false,
            },
            320: {
            items: 3,
            nav: false,
            },
            600: {
            items: 3
            },
            1000: {
            items: 4,
            nav: false
            },
            1100: {
            items: 4,
            nav: false
            },
            1300: {
            items: 4,
            nav: false
            },
            1301: {
            items: 5,
            nav: false
                }
        }
})
$(document).ready(function () {
    'use strict';
    quantityInputs();
    var $searchWrapper = $('.header-search-wrapper'),
    	$body = $('body'),
        $searchToggle = $('.search-toggle');
	$searchToggle.on('click', function (e) {
		$searchWrapper.toggleClass('show');
		$(this).toggleClass('active');
        $('#search-btn').hide();
		$searchWrapper.find('input').focus();
		e.preventDefault();
	});
	$body.on('click', function (e) {
		if ( $searchWrapper.hasClass('show') ) {
			$searchWrapper.removeClass('show');
            $('#search-btn').show();
			$searchToggle.removeClass('active');
			$body.removeClass('is-search-active');
		}
	});
	$('.header-search').on('click', function (e) {
		e.stopPropagation();
	});
	// Sticky header
    var catDropdown = $('.category-dropdown'),
        catInitVal = catDropdown.data('visible');
	if ( $('.sticky-header').length && $(window).width() >= 992 ) {
		var sticky = new Waypoint.Sticky({
			element: $('.sticky-header')[0],
			stuckClass: 'fixed',
			offset: -300,
            handler: function ( direction ) {
                if ( catInitVal &&  direction == 'up') {
                    catDropdown.addClass('show').find('.dropdown-menu').addClass('show');
                    catDropdown.find('.dropdown-toggle').attr('aria-expanded', 'true');
                    return false;
                }
                // Hide category dropdown on fixed header
                if ( catDropdown.hasClass('show') ) {
                    catDropdown.removeClass('show').find('.dropdown-menu').removeClass('show');
                    catDropdown.find('.dropdown-toggle').attr('aria-expanded', 'false');
                }
            }
		});
	}
    // Menu init with superfish plugin
    if ( $.fn.superfish ) {
        $('.menu, .menu-vertical').superfish({
            popUpSelector: 'ul, .megamenu',
            hoverClass: 'show',
            delay: 0,
            speed: 80,
            speedOut: 80 ,
            autoArrows: true
        });
    }
	// Mobile Menu Toggle - Show & Hide
    $('.mobile-menu-toggler').on('click', function (e) {
		$body.toggleClass('mmenu-active');
		$(this).toggleClass('active');
		e.preventDefault();
    });
    $('.mobile-menu-overlay, .mobile-menu-close').on('click', function (e) {
		$body.removeClass('mmenu-active');
		$('.menu-toggler').removeClass('active');
		e.preventDefault();
    });
	// Add Mobile menu icon arrows to items with children
    $('.mobile-menu').find('li').each(function () {
        var $this = $(this);
        if ( $this.find('ul').length ) {
            $('<span/>', {
                'class': 'mmenu-btn'
            }).appendTo($this.children('a'));
        }
    });
    // Mobile Menu toggle children menu
    $('.mmenu-btn').on('click', function (e) {
        var $parent = $(this).closest('li'),
            $targetUl = $parent.find('ul').eq(0);
            if ( !$parent.hasClass('open') ) {
                $targetUl.slideDown(300, function () {
                    $parent.addClass('open');
                });
            } else {
                $targetUl.slideUp(300, function () {
                    $parent.removeClass('open');
                });
            }
        e.stopPropagation();
        e.preventDefault();
    });
	// Sidebar Filter - Show & Hide
    var $sidebarToggler = $('.sidebar-toggler');
    $sidebarToggler.on('click', function (e) {
		$body.toggleClass('sidebar-filter-active');
		$(this).toggleClass('active');
		e.preventDefault();
    });

    $('.sidebar-filter-overlay').on('click', function (e) {
		$body.removeClass('sidebar-filter-active');
		$sidebarToggler.removeClass('active');
		e.preventDefault();
    });

    // Clear All checkbox/remove filters in sidebar filter
    $('.sidebar-filter-clear').on('click', function (e) {
    	$('.sidebar-shop').find('input').prop('checked', false);
    	e.preventDefault();
    });

	// Quantity Input - Cart page - Product Details pages
    function quantityInputs() {
        if ( $.fn.inputSpinner ) {
            $("input[type='number']").inputSpinner({
                decrementButton: '<i class="icon-minus"></i>',
                incrementButton: '<i class="icon-plus"></i>',
                groupClass: 'input-spinner',
                buttonsClass: 'btn-spinner',
                buttonsWidth: '26px'
            });
        }
    }
    if ( $.fn.stick_in_parent && $(window).width() >= 992 ) {
    	$('.sticky-content').stick_in_parent({
			offset_top: 80,
            inner_scrolling: false
		});
    }
    // Checkout discount input - toggle label if input is empty etc...
    $('#checkout-discount-input').on('focus', function () {
        // Hide label on focus
        $(this).parent('form').find('label').css('opacity', 0);
    }).on('blur', function () {
        // Check if input is empty / toggle label
        var $this = $(this);
        if( $this.val().length !== 0 ) {
            $this.parent('form').find('label').css('opacity', 0);
        } else {
            $this.parent('form').find('label').css('opacity', 1);
        }
    });

    // Dashboard Page Tab Trigger
    $('.tab-trigger-link').on('click', function (e) {
    	var targetHref = $(this).attr('href');
    	$('.nav-dashboard').find('a[href="'+targetHref+'"]').trigger('click');
    	e.preventDefault();
    });
    // Scroll To button
    var $scrollTo = $('.scroll-to');
    // If button scroll elements exists
    if ( $scrollTo.length ) {
        // Scroll to - Animate scroll
        $scrollTo.on('click', function(e) {
            var target = $(this).attr('href'),
                $target = $(target);
            if ($target.length) {
                // Add offset for sticky menu
                var scrolloffset = ( $(window).width() >= 992 ) ? ($target.offset().top - 52) : $target.offset().top
                $('html, body').animate({
                    'scrollTop': scrolloffset
                }, 600);
                e.preventDefault();
            }
        });
    }
	// Scroll Top Button - Show
    var $scrollTop = $('#scroll-top');
    $(window).on('load scroll', function() {
        if ( $(window).scrollTop() >= 400 ) {
            $scrollTop.addClass('show');
        } else {
            $scrollTop.removeClass('show');
        }
    });
    // On click animate to top
    $scrollTop.on('click', function (e) {
        $('html, body').animate({
            'scrollTop': 0
        }, 800);
        e.preventDefault();
    });
});

  $("[id*=registerForm]").find('input').jqBootstrapValidation();
  $("[id*=loginForm]").find('input').jqBootstrapValidation();
  $("[id*=register-form]").find('input').jqBootstrapValidation();
  $("[id*=login-form]").find('input').jqBootstrapValidation();
  $("[id*=updateCredential]").find('select').jqBootstrapValidation();
  $("[id*=updateCredential]").find('input').jqBootstrapValidation();

jQuery.event.special.touchstart = {
    setup: function( _, ns, handle ) {
        this.addEventListener("touchstart", handle, { passive: !ns.includes("noPreventDefault") });
    }
  };
$(document).on('click','.btn-quickview',function(e){
    e.preventDefault();
    var variant_id = ($(this).attr("data-id"));
    var get_url = $('#base_url').val();
    $.ajax({
        type:'get',
        url:get_url+'/product/product-quickview/'+variant_id,
        async :true,
        beforeSend: function () {
           // $("body").css("cursor", "progress");
            $("#loader").fadeIn(300);
        },
        success: function (data) {
            $("#quickView").empty();
            $("#quickView").append(data);
            $("body").css("cursor", "default");
            setTimeout(function(){
                $("#loader").fadeOut(300);
              },500);
            $("#quickview-modal").modal("show");
        },
        complete: function (data) {
           // $("body").css("cursor", "default");
        }
    });
})

$(document).on('click','.variant-thumb',function(e){
    e.preventDefault();
    var variant_id = ($(this).attr("data-id"));
    var master_id = ($(this).attr("data-master"));
    var section = ($(this).attr("data-section"));
    var get_url = $('#base_url').val();
    $.ajax({
        type:'get',
        data:{master_id:master_id,section:section },
        url:get_url+'/ajax/get-variant/'+variant_id,
        async :true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            $("a").css("cursor", "progress");
            // $("#loader").fadeIn(300);
        },
        success: function (data) {
            var product  = 'prd-master-'+master_id;
            $('.'+product).empty();
            $('.'+product).append(data);
            //$('.product-nav-slider').owlCarousel();
            $('.product-nav-slider').owlCarousel({
                loop: false,
                //nav: true,
                navText: [
                    "<i class='icon-angle-left'></i>",
                    "<i class='icon-angle-right'></i>"
                ],
                dots: false,
                autoplay: false,
                autoplayHoverPause: true,
                responsive: {
                    0: {
                    items: 3,
                    nav: true,
                    },
                    380: {
                    items: 3,
                    nav: true,
                    },
                    600: {
                    items: 5,
                    nav: true,
                    },
                    1000: {
                    items: 4,
                    nav: false
                    },
                    1100: {
                    items: 4,
                    nav: false
                    },
                    1300: {
                    items: 4,
                    nav: false
                    },
                    1301: {
                    items: 5,
                    nav: false
                        }
                }

            })
        },
        complete: function (data) {
          $("body").css("cursor", "default");
          $("a").css("cursor", "pointer");
        }
    });
})

$(document).on('click','.btn-cart-modal',function(e){
    e.preventDefault();
    var variant_id = ($(this).attr("data-id"));
    var get_url = $('#base_url').val();
    $.ajax({
        type:'get',
        url:get_url+'/cart/get-cart-modal/'+variant_id,
        async :true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            //$("#loader").fadeIn();
        },
        success: function (data) {
            $("#addCart").empty();
            $("#addCart").append(data);
            //$("#loader").fadeOut();
            $("#addCart-modal").modal("show");
        },
        complete: function (data) {
            $("body").css("cursor", "default");
           // $("#loader").fadeOut();
        },
        error: function () {
            toastr.error('something wrong');
          //  $("#loader").fadeOut();
        }
    });
})
 //payplan -popup
$(document).on('click','.payplan-modal-btn',function(e){
    e.preventDefault();
    var variant_id = ($(this).attr("data-id"));
    var get_url = $('#base_url').val();
    $.ajax({
        type:'get',
        url:get_url+'/product/paypaln-popup/'+variant_id,
        async :true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            $("#loader").fadeIn(300);
        },
        success: function (data) {
            $(".payplan-box").empty();
            $(".payplan-box").append(data);
            $.magnificPopup.open({
                    items: {
                        src: '#payplan-modal',
                        type: 'inline'
                    }
                });
            setTimeout(function(){
                $("#loader").fadeOut(300);
              },500);
        },
        complete: function (data) {
            $("body").css("cursor", "default");
        }
    });
})

jQuery(document).on('click', '.btn-wishlist,.btn-wishlist-detals', function(e) {
    var wishlist_id = $(this).attr("data-id");
    var get_url = $('#base_url').val();
    e.preventDefault();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
        },
        url:get_url+'/wishlist/add-to-wishlist',
        type: "POST",
        data: {
            "wishlist_id": wishlist_id,
        },
        success: function(res) {
            // console.log(res);
            if(res.status==true){
                toastr.success(res.msg);
                $(".btn-wishlist").attr("disabled", false);
                if(res){
                   $(".wishlist-count").html(res.data);
                   $('.wishlist-'+wishlist_id).addClass('wishlist-added');
                }else{
                }
            }
            else{
                toastr.warning(res.msg);
            }
        },
    });
});

jQuery(document).on('click', '.remove-wishlist', function(e) {
    var wishlist_id = $(this).attr("data-wishlist");
    if (!confirm("Do you want to delete")){
        return false;
        }
    var get_url = $('#base_url').val();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
        },
        url:get_url+'/wishlist/remove-wishlist',
          type: "POST",
        data: {
            "wishlist_id": wishlist_id,
        },
        success: function(res) {
            if(res.status==true){
                toastr.success(res.msg);
                $('.wishlist-'+wishlist_id).remove();
                $(".btn-wishlist").attr("disabled", false);
                $(".btn-wishlist span").text('Add to wishlist');
                if(res.data.wishlist_count > 0){
                    $(".wishlist-count").text(res.data.wishlist_count);
                }else{
                    $(".wishlist-count").addClass('d-none').text(0);
                }
                $(".wishlist-total-price").text(res.data.wishlist_total);
            }
            else{
                toastr.warning(res.msg);
            }
        },
    });
});

jQuery(document).on('click', '.btn-remove,.remove-cart', function(e) {
    e.preventDefault();
    var qty         = $(this).closest('.row').find('input').val();
    var cart_id     = $(this).attr("data-cart");
    var product_id  = $(this).attr("product-id");
    var the         = this;
    var coupon      = $('#coupon_code').val();
    var get_url = $('#base_url').val();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
            $("#loader").fadeIn(300);
        },
        url:get_url+'/cart/remove-cart',
        type: "POST",
        data: {
            "cart_id": cart_id,
            "qty": qty,
            "coupon": coupon,
        },
        success: function(res) {
            if(res.status==true){
               // toastr.success(res.msg);
               $(the).closest('.cart-'+cart_id).remove();
                $(".btn-cart,.btn-cart-modal").attr("disabled", false);
                $(".btn-cart span").text('Add to cart');
                $('.cart-btn-'+product_id).text('Add to cart');
                $('.cart-btn-'+product_id).addClass('btn-cart-modal').attr("disabled", false);
                $(".btn-cart").addClass('btn-cart-modal');
                if(res.data.cart_count > 0){
                    $(".cart-count").text(res.data.cart_count);
                }else{
                    $(".cart-count").addClass('d-none').text(0);
                }
                $('#order-info').empty();
                $('#order-info').html(res.data.checkout_content);
                $('#mob-order-info').empty();
                $('#mob-order-info').html(res.data.checkout_content);
                $('#checkout_summary2').attr('id','checkout_summary');
                if(res.data.cart_count == 0){
                    $('#cart-list').html('');
                }
                if (res.data.check_offer_variant !== null) {
                    if (res.data.cart_content !== '') {
                        $('#cart-list').html('');
                        $('#cart-list').html(res.data.cart_content);
                        $(".cart-total-price").text('RM '+$('#grand_total').val());
                        $(".subtotal").text('RM '+$('#grand_total').val());
                    }
                    // $(".cart-total-price").text(res.data.offer.grand_total);
                }else{
                    var total_price = 0;
                    $("#cart-list .cart-item").each(function(i, row){
                        if(res.data.cart_count == 0){
                            $('#cart-list').html('');
                        }
                        if (res.data.cart_content !== '') {
                            $('#cart-list').html('');
                            $('#cart-list').html(res.data.cart_content);
                        }
                        var rows  = $(row);
                        var bundle_price = Number(rows.find('#cart_bundle_item_price').val());
                        var price = Number(rows.find('#cart_item_price').val());
                        var qty   = Number(rows.find('.product-qty').val());
                        if (!isNaN(bundle_price)) {
                            total_price += bundle_price;
                        }else{
                            if (!isNaN(price)) {
                                total_price += price*qty;
                            }
                        }
                    });
                    if (coupon !== null) {
                        if (res.data.is_coupon == 1) {
                            var discount_amount = ReplaceNumberWithCommas(parseFloat(res.data.regular_coupon_discount).toFixed(2));
                            $("#apply_coupon span").text('Reset');
                            $("#apply_coupon2 span").text('Reset');
                            $("[id*=discount_tr]").css('display','table-row');
                            if (res.data.coupon_type == 1) {
                                $("[id*=coupon_status_msg]").html('Coupon applied !<br>'+'-RM'+discount_amount+' ('+res.data.discount+'% off)');
                            }else{
                                $("[id*=coupon_status_msg]").html('Coupon applied !<br>'+'-RM '+discount_amount);
                            }
                            $("[id*=coupon_discount]").text(discount_amount);
                            $("#coupon_regular_discount").val(res.data.regular_coupon_discount);
                            $("#coupon_ins_discount").val(res.data.ins_coupon_discount);
                        }else{
                            $("#apply_coupon span").text('Apply');
                            $("#apply_coupon2 span").text('Apply');
                            $("#coupon_code").val('');
                            $("#coupon_code2").val('');
                            $("[id*=discount_tr]").fadeOut();
                            $("[id*=coupon_status_msg]").html('');
                            $("#coupon_regular_discount").val(0);
                            $("#coupon_ins_discount").val(0);
                        }
                    }
                    $(".cart-total-price").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                    $(".subtotal").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                }
            }
            else{
                toastr.warning(res.msg);
            }
            $("#loader").fadeOut(300);
        },
    });
});

function duplicateEmail(e) {
    var email = $(e).val();
    var get_url = $('#base_url').val();
    $.ajax({
        type: "POST",
        url:get_url+'/user/check-email',
        data: {
            email: email
        },
        dataType: "json",
        success: function (data) {
            if (data == true) {
                toastr.error('User Already Exist');
                $('#email').val('');
            }
        },
        error: function (jqXHR, exception) {}
    });
}

$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});
$(document).on('submit', "#registerForm", function (e) {
    e.preventDefault();

    var form = $("#registerForm");
    $.ajax({
        type: 'post',
        data: form.serialize(),
        url: form.attr('action'),
        async: true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            $("#loader").fadeIn(300);
        },
        success: function (data) {
            if (data.status == true) {
                toastr.success(data.msg);
                location.reload();
                $('#registerForm')[0].reset();
                $('#signin-modal').modal('hide');
            } else {
                toastr.error(data.msg);
            }
            // console.log(data);
        },
        error: function (jqXHR, exception) {
            toastr.error('something wrong');
            $("#loader").fadeOut();
        },
        complete: function (data) {
            $("body").css("cursor", "default");
            $("#loader").fadeOut();
        }
    });
});
$(document).on('submit', "#loginForm", function (e) {
    e.preventDefault();
    var form = $("#loginForm");
    var is_modal = form.find('#is_modal').val();
    var get_url = $('#base_url').val();
    $.ajax({
        type: 'post',
        data: form.serialize(),
        url: form.attr('action'),
        async: true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            $("#loader").fadeIn(300);
        },
        success: function (data) {
            console.log(data);
            if (data.status == true) {
                if (is_modal == 1) {
                    toastr.success(data.msg);
                    $('#loginForm')[0].reset();
                    $('#signin-modal').modal('hide');
                    location.reload();
                }else{
                    window.open(get_url, '_self');
                    toastr.success(data.msg);
                }
            }
            else{
                toastr.error(data.msg);
            }
        },
        error: function (jqXHR, exception) {
            toastr.error('Oppes! You have entered invalid credentials').fadeOut(9999);
            $("#loader").fadeOut();
        },
        complete: function (data) {
            $("body").css("cursor", "default");
            $("#loader").fadeOut();
        }
    });
});

$(document).on('submit', "#subscriberForm", function (e) {
    e.preventDefault();
    if ($(this).find('#email').val().length == 0) {
        alert('Please Enter Your Email Address');
        return false;
    }
    var form = $("#subscriberForm");
    $.ajax({
        type: 'post',
        data: form.serialize(),
        url: form.attr('action'),
        async: true,
        beforeSend: function () {
            $("body").css("cursor", "progress");
            $("#loader").fadeIn(300);
        },
        success: function (data) {
            // console.log(data);
            if (data.status == true) {
                toastr.success(data.msg);
                $('#subscriberForm')[0].reset();
            } else {
                toastr.error(data.msg);
            }
            $("body").css("cursor", "default");
            setTimeout(function(){
                $("#loader").fadeOut(300);
              },500);
        },
        error: function (jqXHR, exception) {
            toastr.error('something wrong');
            setTimeout(function(){
                $("#loader").fadeOut(300);
              },500);
        },
        complete: function (data) {
            $("body").css("cursor", "default");
        }
    });
});


$("#leftside-navigation .sub-menu > a").click(function(e) {
    $("#leftside-navigation ul ul").slideUp(), $(this).next().is(":visible") || $(this).next().slideDown(),
    e.stopPropagation()
  })
  $(document).on('click', '.has_offer', function(e){
    $(this).closest('.hotsale-img').find('.offer_body').toggleClass('d-none');
    $(this).toggleClass('d-none');
})
/* ====================================================================== *
        GO TO WHATSAPP
 * ====================================================================== */
$(document).on('click', '#open-chat-box', function(e){
    $('#chat-box').show('popup-box-on');
    $('#open-chat-box i').removeClass("fa-whatsapp").addClass('fa-times',{duration:300});
    $('#open-chat-box').removeClass("chat-open-btn").addClass('chat-close-btn',{duration:300});
    e.preventDefault()
})
$(document).on('click', '.chat-close-btn', function(e){
    $('#chat-box').fadeOut('popup-box-on');
    $('#open-chat-box i').removeClass("fa-times").addClass('fa-whatsapp',{duration:300});
    $('#open-chat-box').removeClass("chat-close-btn").addClass('chat-open-btn',{duration:300});
    e.preventDefault()
})
$(document).on('click', '.hide-icon', function(e){
    $('#open-chat-box,.chat-btn-label').hide(300);
    $('#chat-r-icon').removeClass('hide-icon').addClass('open-icon',{duration:300});
    $('#chat-r-icon i').removeClass("fa-angle-right").addClass('fa-angle-left',{duration:300});
    e.preventDefault()
})
$(document).on('click', '.open-icon', function(e){
    $('#open-chat-box,.chat-btn-label').show(300);
    $('#chat-r-icon').removeClass('open-icon').addClass('hide-icon',{duration:300});
    $('#chat-r-icon i').removeClass("fa-angle-left").addClass('fa-angle-right',{duration:300});
    e.preventDefault()
})

$(document).on('click', '.popup-person', function(e){
    var $this = $(this);
    if(!$this.hasClass('popup-person-offline')){
        var defaultMsg = $this.attr('data-default-msg');
        if($this.attr('data-default-msg') !== undefined){
            defaultMsg = $this.attr('data-default-msg').split('{{url}}').join(window.location.href);
        }
        go_to_whatsapp($this.attr('data-number'), defaultMsg);
    }
})

function go_to_whatsapp(number, text){
    var WhatsAppUrl = 'https://web.whatsapp.com/send';
    if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        WhatsAppUrl = 'https://api.whatsapp.com/send';
    }
    var url         = WhatsAppUrl+'?phone='+number+'&text='+text;
    var win         = window.open(url, '_blank');
    win.focus();
}


$(document).on('click', '#sku', function(e) {
    e.preventDefault();
        var copyText = $(this).attr('data-sku');
        var textarea = document.createElement("textarea");
        textarea.textContent = copyText;
        textarea.style.position = "fixed"; // Prevent scrolling to bottom of page in MS Edge.
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        toastr.success('Copied the SKU '+copyText, {timeOut: 5000})
});

$(document).on('input change keyup keypress', '.max_val_check',function(e){
    var val = Number($(this).val());
    var max = Number($(this).attr('max'));
    if (val > max) {
        $(this).val(max);
        $(this).change();
        // console.log(max);
    }
});
$(document).on('change', '.min_val_check',function(e){
    var val = Number($(this).val());
    var min = Number($(this).attr('min'));
    if (val < min) {
        $(this).val(min);
        $(this).change();
    }
});
$(document).on("keyup paste change keypress",".quantity", function (evt) {
    var self = $(this);
    self.val(self.val().replace(/[^0-9\.]/g, ''));
    if ((evt.which != 46 || self.val().indexOf('.') != -1) && (evt.which < 48 || evt.which > 57))
    {
        evt.preventDefault();
    }
});
$(document).on('input', '.remove_first_zero', function(e) {
    if((this.value+'').match(/^0/)) {
        this.value = (this.value+'').replace(/^0+/g, '');
    }
});

jQuery(document).on('click', '.btn-cart', function(e) {
    var flag = true;
    var qty = $('#qty').val();
    var cart_type = $(this).data('popup');
    var warehouse = $(this).closest('form').find("input[type='radio'].warehouse-radio:checked").val();
    var payment_plan = $("input[name='payment_plan']:checked").val();
    if(warehouse == undefined){
        alert('Please Select Stock Location');
        flag = false;
        return false;
    }
    var warehouse = $("input[type='radio'].warehouse-radio:checked").attr("warehouse");
    var shippment = $("input[type='radio'].warehouse-radio:checked").attr("shippment_no");
    $("input[name='warehouse']").val(warehouse);
    $("input[name='shippment_no']").val(shippment);
    var product_id  = $("input[name='product_id']").val();

    if(flag == true){
        if (cart_type == 'quickview') {
            var form = $("#addToCartQuickView");
        }else{
            var form = $("#addToCart");
        }
        jQuery.ajax({
            beforeSend: function (xhr) {
                xhr.setRequestHeader('X-CSRF-Token', $('[name="_csrfToken"]').val());
                $("#loader").fadeIn(300);
         },
        type: "POST",
        data:form.serialize(),
        url:form.attr('action'),
        success: function(res) {
            if(res.status==true){
                toastr.success(res.msg).fadeOut(2000);

                var this_cart  = 'cart-btn-'+product_id;
                $(".btn-cart").attr("disabled", true);
                $('.'+this_cart).html("Added").attr("disabled", true);
                $('.'+this_cart).removeClass('btn-cart-modal');
                $(".cart-count").removeClass('d-none').text(res.data.cart_count);
                $("#addCart-modal").modal("hide");
                $("#quickview-modal").modal("hide");
                $("#cartModal").modal("show");
                // if (res.data.check_offer_variant !== null && res.data.offer.bundle !== '') {
                if ((typeof res.data.offer !== "undefined") && (typeof res.data.offer.data !== "undefined") && (typeof res.data.offer.data.bundle !== "undefined") && res.data.cart_content !== ''){
                    $('#cart-list').html('');
                    $('#cart-list').html(res.data.cart_content);
                    $(".cart-total-price").text('RM '+$('#grand_total').val());
                    $(".subtotal").text('RM '+$('#grand_total').val());
                }else{
                    if(res.data.cart_content !== ''){
                        // $('#cart-list').prepend(res.data.cart_content);
                        $('#cart-list').html('');
                        $('#cart-list').html(res.data.cart_content);
                    }
                    var total_price = 0;
                    $("#cart-list .cart-item").each(function(i, row){
                        var rows  = $(row);
                        var bundle_price = Number(rows.find('#cart_bundle_item_price').val());
                        var price = Number(rows.find('#cart_item_price').val());
                        var qty   = Number(rows.find('.product-qty').val());
                        if (!isNaN(bundle_price)) {
                            total_price += bundle_price;
                        }else{
                            if (!isNaN(price)) {
                                total_price += price*qty;
                            }
                        }
                    });
                    $(".cart-total-price").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                    $(".subtotal").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                }
            }else{
                toastr.warning(res.msg).fadeOut(2000);
            }
        },
        complete: function (data) {
            $("#loader").fadeOut(300);
        }
    });
    }
});
jQuery(document).on('click', '.change-pick', function(e) {
    var cart_id = $(this).attr("data-id");
    var get_url = $('#base_url').val();
    e.preventDefault();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
           $("#preloader").fadeIn(300);
        },
        url:get_url+'/ajax/update-cart-location',
        type: "POST",
        data: {
            "cart_id": cart_id,
        },
        success: function(data) {
            if (data.status == false) {
                toastr.warning(data.msg).fadeOut(3000);
                $("#preloader").fadeOut(300);
            }else{
                $(".cart-popup-body").empty();
                $(".cart-popup-body").append(data);
                $.magnificPopup.open({
                        items: {
                            src: '#update-cart',
                            type: 'inline'
                        }
                    });
                setTimeout(function(){
                    $("#preloader").fadeOut(300);
                },500);
            }
        },
    });
});
$(document).on('click','.warehouse-radio',function(){
    var id              = $(this).data('id');
    var key             = $(this).data('key');
    var available       = $(this).data('available');
    var variant_id      = $(this).attr("variant-id");
    var warehouse       = $(this).attr("warehouse"); //WAREHOUSE
    var cart_id         = $(this).attr("cart-id");
    var shippment       = $(this).attr("data-shippment");
    var price_plan_div  = 'price-plan-'+key+'-'+variant_id;
    var price_regular   = 'regular-price-'+key+'-'+variant_id;
    var arrive_form     = 'label-'+key+'-'+variant_id;
    var point           = 'point_'+variant_id;
    $('.'+point+' .warehouse-radio').prop('checked', false);
    $('.'+point+' .warehouse-radio').removeAttr("checked");
    $('.qty_'+cart_id).prop('max',available);
    $('.qty_'+cart_id).change();
    if ($(this).is(":checked")) {
        $('.'+price_plan_div).fadeIn();
        $('.'+point+' .price-plan').not('.'+price_plan_div).hide();
        $('.'+arrive_form).css({ "color": "#F78902"});
        $('.custom-control-label').not('.'+arrive_form).removeAttr('style');

        $('.warehouse-radio').each(function () {
            var thisVariant   = (this.checked ? $(this).attr('variant-id') : "");
            var thisKey       = (this.checked ? $(this).data('key') : "");
            var checkedCss    = 'label'+'-'+ thisKey+'-'+thisVariant;
            $('.'+checkedCss).css({ "color": "#F78902"});
        });
    }else {
        $(".price-plan").hide(500);
    }
    if (!isNaN(cart_id)) {
        updatePickPoint(warehouse,cart_id,shippment);
    }else{
        $('.qty_').prop('max',available);
    }
    var input_id = $(this).attr('id');
    $('[id*='+input_id+']').prop('checked',true);
    $('[id*='+input_id+']').attr('checked','checked');
})
function updatePickPoint(warehouse,cart_id,shippment){
    var warehouse   = warehouse;
    var cart_id     = cart_id;
    var shippment   = shippment;
    var get_url = $('#base_url').val();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
        },
        url:get_url+'/cart/update_pick_point',
        type: "POST",
        cache : false,
        data: {
            "warehouse": warehouse,
            "cart_id": cart_id,
            "shippment": shippment,
        },
        success: function(res) {
            if(res.status==true){
                toastr.success(res.msg).fadeOut(2000);
                $('#update-cart').hide();
                $('.mfp-container').hide();
            }else{
                toastr.warning(res.msg).fadeOut(3000);
            }
        },
        complete: function (data) {
            location.reload(true);
        }
    });

}
//count line total
function countLinePrice(thisVariant,thisPrice,thisQty){
    var linetotal        = 0;
    linetotal            = parseFloat(linetotal) + parseFloat(thisPrice * thisQty);
    var total            = linetotal.toFixed(2);
    var total_col        = 'total_col_'+thisVariant;
    var total_line_price  = 'total_line_'+thisVariant;
    $('.'+total_col).text(total);
    $('.'+total_line_price).val(total);
    setGrandTotal();
}
//set grand total
function setGrandTotal(){
    var freightCost     = 0;
    var total_tax       = 0;
    var subtotal        = 0;
    var order_qty       = 0;
    var shipping_cost   = 0;
    var coupon_amount   = 0;
    $(".line_price").each(function( index ) {
        subtotal +=  Number( $( this ).val());
    });
    $("[id*=product-qty]").each(function( index ) {
        order_qty += Number( $( this ).val());
    });
    var order_price     = subtotal+total_tax+shipping_cost-coupon_amount;
    $('.subtotal').text(order_price.toFixed(2));
    $('.itemCounter').text(order_qty);
}
$(document).on('change','.product-qty',function(){
    $("#loader").fadeIn(300);
    var thisVariant     = $(this).attr('variant-id');
    var thisCart        = $(this).attr('cart-id');
    var total_col       = 'price_'+thisVariant;
    var thisPrice       = $('.'+total_col).val();
    var thisQty         = $(this).val() ?? 1;
    var thisPrevValue   = $(this).attr("data-value");
    if (!isNaN(thisCart) && thisCart !== null && thisCart != '') {
        updateQuty(thisCart,thisVariant,thisQty,thisPrevValue,this);
    }
    $("#loader").fadeOut(300);
})
function updateQuty(thisCart,thisVariant,thisQty,thisPrevValue,the){
    var variant_id      = thisVariant;
    var cart_id         = thisCart;
    var qty             = thisQty;
    var prev_value      = thisPrevValue;
    var coupon          = $('#coupon_code').val();
    var get_url = $('#base_url').val();
    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
        },
        url:get_url+'/cart/update_cart_qty',
        type: "POST",
        async :false,
        cache : false,
        data: {
            "variant_id": variant_id,
            "cart_id": cart_id,
            "prev_value": prev_value,
            "qty": qty,
            "coupon": coupon,
        },
        success: function(res) {
            if(res.status==true){
                $(the).attr('data-value',thisQty);
                $('#order-info').empty();
                $('#order-info').html(res.data.checkout_content);
                $('#mob-order-info').html(res.data.checkout_content);
                $('#checkout_summary2').attr('id','checkout_summary');
                if ((typeof res.data.offer !== "undefined") && (typeof res.data.offer.data !== "undefined") && (typeof res.data.offer.data.bundle !== "undefined") && res.data.cart_content !== '') {
                    $('#cart-list').html('');
                    $('#cart-list').html(res.data.cart_content);
                    $(".cart-total-price").text('RM '+$('#grand_total').val());
                    $(".subtotal").text('RM '+$('#grand_total').val());
                }else{
                    if(res.data.cart_content !== '') {
                        $('#cart-list').html('');
                        $('#cart-list').html(res.data.cart_content);
                    }
                    var total_price = 0;
                    $("#cart-list .cart-item").each(function(i, row){
                        var rows  = $(row);
                        var bundle_price = Number(rows.find('#cart_bundle_item_price').val());
                        var price = Number(rows.find('#cart_item_price').val());
                        var qty   = Number(rows.find('.product-qty').val());
                        if (!isNaN(bundle_price)) {
                            total_price += bundle_price;
                        }else{
                            if (!isNaN(price)) {
                                total_price += price*qty;
                            }
                        }
                    });
                    $(".cart-total-price").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                    $(".subtotal").text('RM '+ReplaceNumberWithCommas(parseFloat(total_price).toFixed(2)));
                }
                if (coupon !== null) {
                    if (res.data.is_coupon == 1) {
                        var discount_amount = ReplaceNumberWithCommas(parseFloat(res.data.regular_coupon_discount).toFixed(2));
                        $("#apply_coupon span").text('Reset');
                        $("#apply_coupon2 span").text('Reset');
                        $("[id*=discount_tr]").css('display','table-row');
                        if (res.data.coupon_type == 1) {
                            $("[id*=coupon_status_msg]").html('Coupon applied !<br>'+'-RM'+discount_amount+' ('+res.data.discount+'% off)');
                        }else{
                            $("[id*=coupon_status_msg]").html('Coupon applied !<br>'+'-RM '+discount_amount);
                        }
                        $("[id*=coupon_discount]").text(discount_amount);
                        $("#coupon_regular_discount").val(res.data.regular_coupon_discount);
                        $("#coupon_ins_discount").val(res.data.ins_coupon_discount);
                    }else{
                        $("#apply_coupon span").text('Apply');
                        $("#apply_coupon2 span").text('Apply');
                        $("#coupon_code").val('');
                        $("#coupon_code2").val('');
                        $("[id*=discount_tr]").fadeOut();
                        $("[id*=coupon_status_msg]").html('');
                        $("#coupon_regular_discount").val(0);
                        $("#coupon_ins_discount").val(0);
                    }
                }
                $(".cart-count").removeClass('d-none').text(res.data.cart_count);
                toastr.success(res.msg).fadeOut(2000);
            }
            else{
                toastr.warning(res.msg);
                $(the).attr('data-value',prev_value);
                $(the).val(prev_value);
            }
        },
        complete: function (data) {
            $("#loader").fadeOut(300);
        }
    });
}
$(document).on('click','#add_order_note',function(){
    var order_note = $('#order_note').val();
    var get_url = $('#base_url').val();

    jQuery.ajax({
        beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('[name="csrf-token"]').attr('content'));
        },
        url:get_url+'/cart/update_order_note',
        type: "POST",
        data: {
            "order_note": order_note,
        },
        success: function(res) {
            if(res.status==true){
                toastr.success(res.msg).fadeOut(2000);
            }
            else{
                toastr.warning(res.msg).fadeOut(3000);
            }
        },
    });
});
function ReplaceNumberWithCommas(Number) {
    //Seperates the components of the number
    var n= Number.toString().split(".");
    //Comma-fies the first part
    n[0] = n[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    //Combines the two sections
    return n.join(".");
}
